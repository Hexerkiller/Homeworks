Отчет : По данному сайту "http://3.69.22.63/"

1. Зашли на сайт проверили что он действительно не работает.

 	Показана ошибка связанная с файлом - LocalSettings.php"

 	"$wgServer must be set in LocalSettings.php."

 	Ошибка указывает что проблема в том что переменная- $wgServer"
 	должна быть заполнена.
 

2.Зашли на сервер  и посмотрели статус сервиса

 	Заходим на сервер командой :

 		ssh -i .ssh/ich.pem ec2-user@3.69.22.63
 
 	Проверяем статус веб сервиса:
 
 		sudo service httpd status
 
 	этой командой мы с правами суперпользователя проверяем статус

 	Статус показал что он в активном режиме. Пробуем перезапустить
 	его
 		sudo service httpd restart

 	После перезагрузки ничего не поменялось ошибка осталась
 
3.Работа с файлом  LocalSettings.php и памятью
 
 	На сервере находим файл "LocalSettings (5).php"
 	в папке  /home/ec2-user

 	Для работоспособности файл должен лежать в /var/www/html/mediawiki/

 	Пытаемся скопировать этот файл:
  cp /home/ec2-user/LocalSettings\ \(5\).php  /var/www/html/mediawiki/LocalSettings.php

 	И получили ошибку:
 	cp: failed to extend '/var/www/html/mediawiki/LocalSettings.php': No space left
 	on device

 	Из ошибки понимаем что нету места на диске и проверяем его

 		df -h (Смотрим место на диске в человеко-читабельном формате)

 	Видим что диск полностью забит:

 		/dev/nvme0n1p1 10G 10G 0 100% /
 
 	Питаемся найти файли которые занимают очень много места:
 
 		sudo find / -type f -size +200M -exec du -h {} \;
 	(C правами пользователя ищем файлы типа файл и размером +200М и отображаем их память в человеко-читабельном формате )

 	Находим два файла:

 		309M   /var/log/httpd/log_20260105.tar.gz
 		7.0G   /var/log/httpd/access_log-20260105
 
 	Понимаем что файл access_log-20260105 занял все место.

 	(Access log - это журнал работы сервера, в который он записывает все запросы)

 	Перезаписываем файл или удаляем (в данном случаи удаляем) также удаляем ненужные архивы
 	через:
 				sudo rm -rf ...
 
 	Проверяем появилось ли место.
 
 				df -h
 
 	Далие снова копируем файл  LocalSettings (5).php в правильное место.
 
 	Заходим на сайт для проверки и получаем ошибку
 
 			This site can`t be reached
 			18.153.51.162 took to long to respond.

 	Понимаем что проблема в том что не сходиться IP адрес
 
 	Возвращаемся на сервер в файл

 		/var/www/html/mediawiki/LocalSettings.php
 
 	И видим что в переменной не тот IP
 
 			$wgServer = "https://18.153.51.162";
 
 	Заменяем на правильную.

 			$wgServer = "https:http://3.69.22.63";
 
 	Все проверяем.

4. Решаем проблему с механизмом очистки
 
 	Создаем механизм очистки для : /var/log/httpd/access_log

 	Для начала останавливаем некорректную задачу в cron

 			 	crontab -e

 	Видим задачу без таймингов и останавливаем её (коментим)

 	* * * * * tar -czf /var/log/httpd/log_$(date +\%Y\%m\%d).tar.gz -C /var/log/httpd
 
 	#* * * * * tar -czf /var/log/httpd/log_$(date +\%Y\%m\%d).tar.gz -C /var/log/httpd
 
 	Создаем свой скрипт для нормальной архивации и очистки
 
 				**Разбор скрипта "**backup_httpd_logs.sh"
 
#!/bin/bash
#
LOG_DIR="/var/log"
BACKUP_DIR="/home/ec2-user/backup_log"
DATE=$(date '+%Y%m%d-%T')
ARCHIVE="$BACKUP_DIR/backup_log_$DATE.tar.gz"

(создали переменные для удобности и сокращения )

mkdir -p "$BACKUP_DIR"

(создаем директорию ключ -р для того чтобы при необходимости каталог был создан а если он есть то окей )

tar -czf "$ARCHIVE" "$LOG_DIR"/*
(архивация)
( tar - утилита  -с создаем архив  -z сжать с помощью gzip  -f имя из переменной)

service httpd stop

(остановка сервиса)

rm -rf $LOG_DIR/httpd/*

(чистка всех логов в папке)

service httpd start

(запуск сервиса)

find "$BACKUP_DIR" -type f -name "backup_log_*.tar.gz" -mtime +3 -exec rm -rf {} \;

(система чистки старых архивов)
(find- утилита поиск  -type  f - только файлы  - name файлы только с именем такого то вида
  -mtime +3   файлы измененные более 3 суток назад  -exec rm -rf  удаляет каждый найденный файл  {} имя файла
\; завершает роботу -exec)

 
 	Активируем исполняемость скрипта:

 			chmod +x backup_httpd_logs.sh

 	Проверяем скрипт запустив его :
 			./backup_httpd_logs.sh
 
 	Если все в норме то пишем новую задачу в cron:
 
 				crontab -e

 		5 3 * * * /home/ec2-user/backup_httpd_logs.sh

 		(Запуск каждый день в 03:05 )

 	И под конец перезапускаем сервер:
 
 		sudo service httpd restart

				Причины для такой проблемы

	- отсутствие метода очистки старых архивов и логов
	- неправильно заданный айпишник в LocalSettings.php 
	- плохой механизм архивации
 	- не корректно настроен cron

	Одним словом плохой Админ

		Предпринятые шаги для восстановления сервиса и устранения проблемы и полученные результаты

	- Зашли на сайт проверили что он действительно не работает
	- Зашли на сервер  и посмотрели статус сервиса
	- Перезарузка сервера
	- Поладка найденных проблем
	- Сознание и настойка механизмов для автоматизации  
	- Проверка и перезапуск

			Рекомендации и предложения по улучшению процессов
 
	- время от времени проверять память на дисках
	- всегда проверять корректность скриптов и выполненных задач перед отданием в Продакшн(желательно минимум 2 раза) 

 					Конец

 